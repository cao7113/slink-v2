# https://taskfile.dev/usage/
version: "3"
tasks:
  default: mix test
  sh: iex --erl "-kernel shell_history enabled" -S mix
  run: iex --erl "-kernel shell_history enabled" -S mix phx.server
  r6:
    env:
      # local livebook deployed with ipv6
      ERL_AFLAGS: "-proto_dist inet6_tcp -kernel shell_history enabled"
      # RELEASE_DISTRIBUTION: name
    cmds:
      # iex(slink2@mac.local)1>
      - iex --cookie slink2 --name slink2 -S mix phx.server

  fmt: mix format

  ## Git ops
  ops.init: mix git_ops.release --initial
  ops.up: |
    mix git_ops.release --yes
    git push --follow-tags
    fly deploy
  ops.up.rel: mix git_ops.release
  ops.up.tag: git push --follow-tags
  ops.types: mix eh.git.ops.types
  ops.setup: |
    # run after add igniter dep in mix.exs
    mix igniter.install git_ops

  ## DB ops
  pg: pgcli slink_v2_dev
  db.reset: |
    mix ecto.reset.force
    MIX_ENV=test mix ecto.reset.force
    echo reset dev and test db

  setup: |
    mix deps.get
